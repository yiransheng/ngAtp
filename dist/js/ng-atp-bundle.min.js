/*! ng-atp 13-05-2015 */
!function(a,b){"use strict";var c=angular||a.angular;if(!c)throw"Missing Angular base. Include ng-atp after Angular.";"function"==typeof define&&define.amd?define([],b(c)):"object"==typeof exports?module.exports=b(c):b(c)}(this,function(a){function b(b){return{initialized:!1,$new:function(c){var d=Object.create(this);if(d.selected=-1,d.query="",d.suggestions=[],d._idAttrib=c.idAttribute,d.completeOn=c.completeOn||{tab:!0,rightArrow:!0},a.isFunction(c.verify)&&(d.verify=c.verify),a.isFunction(c.format)&&(d.format=c.format),d.engine=new b({datumTokenizer:c.datumTokenizer||function(a){return b.tokenizers.whitespace(d.format(a))},queryTokenizer:c.queryTokenizer||b.tokenizers.whitespace,prefetch:c.prefetch,remote:c.remote,local:c.local,limit:c.limit,dupDetector:c.dupDetector||(d._idAttrib?function(a,b){return a===b||a&&b&&a[d._idAttrib]===b[d._idAttrib]}:a.equals),sorter:c.sorter}),d.engine.initialize(),d.verify(c.initialvalue)){var e=a.extend({},c.initialvalue);d.value=c.initialvalue,d.engine.add([e]),d.query=d.format(e)}else d.value=null;return d.initialized=!0,d.showSuggestions=!1,d},verify:function(a){return null!==a},format:function(a){return a?a.value:""},clear:function(){this.selected=-1,this.suggestions.length=0,this.showSuggestions=!1},getByIndex:function(a){return 0>a||a>=this.suggestions.length?null:this.suggestions[a]},select:function(a){a=+a;var b=this.suggestions.length;return 0===b?this.selected=-1:0===this.selected&&0>a?0:this.selected===b-1&&a>=b?b-1:this.selected=a},search:function(b){return a.isDefined(b)?this.query=b:b=this.query,c(b)?void this.clear():(this.value=null,this.exportValue(null),void this.engine.get(b,function(a){if(this.showSuggestions=c(this.query)?!1:!0,!this.isComplete()){var b=a.concat(this.suggestions),d=this._idAttrib;this.suggestions=d?e(b,function(a){return a[d]}):e(b,function(a){return this.format(a)}.bind(this))}}.bind(this)))},getSuggested:function(a){if(0===this.suggestions.length)return null;if(1===this.suggestions.length){if(a){var b=this.format(this.suggestions[0]);return d(b,this.query)?this.suggestions[0]:null}return this.suggestions[0]}return-1===this.selected?a?this.suggestions.find(function(a,b){var c=this.format(a);return d(c,this.query)?(this.select(b),!0):!1},this)||null:this.suggestions[0]:this.getByIndex(this.selected)},exportValue:a.noop,tryComplete:function(b){if(this.isComplete())return!0;var c,d=a.isDefined(b)?this.suggestions[b]:this.getSuggested();return this.verify(d)?(this.value=d,this.query=this.format(d),c=a.extend({},this.value),this.exportValue(c),this.clear(),!0):(this.exportValue(null),!1)},tryCompleteExact:function(){var a,b=this.suggestions.length,c=0;for(a=0;b>a;a++)if(d(this.format(this.suggestions[a]).toLowerCase(),this.query.toLowerCase())&&c++,c>1)return!1;var e=this.suggestions.findIndex(function(a){return this.format(a).toLowerCase()===this.query.toLowerCase()},this);return e>-1?this.tryComplete(e):!1},isComplete:function(){return this.format(this.value)===this.query&&this.verify(this.value)}}}function c(b){return a.isUndefined(b)||""===b||null===b||b!==b}function d(a,b){return a.length&&b.length&&a.slice(0,b.length)===b}function e(b,c){var d=[],e={};return a.forEach(b,function(a){var b=c(a);e[b]||(d.push(a),e[b]=!0)}),d}function f(b,c,d,e,f,g){var h=c.attr("ng-atp"),i=c.attr("ng-atp-config")||"",j=d(h),k=j.assign,l=d(i),m=b.$parent,n=j(m),o=l(m);o=Object.create(o),o.initialvalue=n,b.ATP=e.$new(o),b.ATP.modelExpression=h,b.ATP.importValue=function(){return j(m)},b.onClickSuggestion=function(a){var c=b.ATP.tryComplete(a);b.ATP.showSuggestions=!c,c&&b.$emit(g.COMPLETE,{value:b.ATP.importValue(),triggeredBy:g.triggers.click,model:b.ATP.modelExpression})},b.ATP.exportValue=function(b){return a.equals(b,j(m))?!1:(k(m,b),!0)},b.$watch("ATP.query",function(a){return f.isEmpty(a)?(b.ATP.clear(),void b.ATP.exportValue(null)):void(b.ATP.isComplete()||b.ATP.search())}),b.$watch("ATP.suggestions",function(a){var c=b.ATP.tryCompleteExact();b.ATP.showSuggestions=a.length?!c:!1,c&&b.$emit(g.COMPLETE,{value:b.ATP.importValue(),triggeredBy:g.triggers.manual,model:b.ATP.modelExpression})}),m.$watch(function(){return j(m)},function(a){var c=b.ATP.engine.dupDetector;c(a,b.ATP.value)||(b.ATP.value=a,b.ATP.query=b.ATP.format(a),b.ATP.showSuggestions=!1)},!0)}!function(a){var b="0.10.2";!function(){"use strict";var b=a.module("bloodhound.tokenizers",[]);b.factory("tokenizers",function(){var a=function(){function a(a){return a.split(/\s+/)}function b(a){return a.split(/\W+/)}function c(a){return function(b){return function(c){return a(c[b])}}}return{nonword:b,whitespace:a,obj:{nonword:c(b),whitespace:c(a)}}}();return a})}(),function(){"use strict";var b=a.module("bloodhound.lru-cache",[]);b.factory("LruCache",function(){var b=function(){function b(a){this.maxSize=a||100,this.size=0,this.hash={},this.list=new c}function c(){this.head=this.tail=null}function d(a,b){this.key=a,this.val=b,this.prev=this.next=null}return a.extend(b.prototype,{set:function(a,b){var c,e=this.list.tail;this.size>=this.maxSize&&(this.list.remove(e),delete this.hash[e.key]),(c=this.hash[a])?(c.val=b,this.list.moveToFront(c)):(c=new d(a,b),this.list.add(c),this.hash[a]=c,this.size++)},get:function(a){var b=this.hash[a];return b?(this.list.moveToFront(b),b.val):void 0}}),a.extend(c.prototype,{add:function(a){this.head&&(a.next=this.head,this.head.prev=a),this.head=a,this.tail=this.tail||a},remove:function(a){a.prev?a.prev.next=a.next:this.head=a.next,a.next?a.next.prev=a.prev:this.tail=a.prev},moveToFront:function(a){this.remove(a),this.add(a)}}),b}();return b})}(),function(){"use strict";var b=a.module("bloodhound.persistent-storage",[]);b.factory("PersistentStorage",function(){var b=function(){function b(a){this.prefix=["__",a,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix)}function c(){return(new Date).getTime()}function d(b){return JSON.stringify(a.isUndefined(b)?null:b)}function e(a){return JSON.parse(a)}var f,g;try{f=window.localStorage,f.setItem("~~~","!"),f.removeItem("~~~")}catch(h){f=null}return g=f&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){return this.isExpired(a)&&this.remove(a),e(f.getItem(this._prefix(a)))},set:function(b,e,g){return a.isNumber(g)?f.setItem(this._ttlKey(b),d(c()+g)):f.removeItem(this._ttlKey(b)),f.setItem(this._prefix(b),d(e))},remove:function(a){return f.removeItem(this._ttlKey(a)),f.removeItem(this._prefix(a)),this},clear:function(){var a,b,c=[],d=f.length;for(a=0;d>a;a++)(b=f.key(a)).match(this.keyMatcher)&&c.push(b.replace(this.keyMatcher,""));for(a=c.length;a--;)this.remove(c[a]);return this},isExpired:function(b){var d=e(f.getItem(this._ttlKey(b)));return a.isNumber(d)&&c()>d?!0:!1}}:{get:a.noop,set:a.noop,remove:a.noop,clear:a.noop,isExpired:a.noop},a.extend(b.prototype,g),b}();return b})}(),function(){"use strict";var b=a.module("bloodhound.transport",["bloodhound.lru-cache"]);b.factory("Transport",function(b,c,d,e){function f(a){return function(b){a(b.data)}}var g=function(){function c(a){a=a||{},this._send=a.transport?callbackToDeferred(a.transport):b.get,this._get=a.rateLimiter?a.rateLimiter(this._get):this._get}var g=0,h={},i=6,j=new e(10),k="";return c.setMaxPendingRequests=function(a){i=a},c.resetCache=function(){j=new e(10)},a.extend(c.prototype,{_get:function(a,b,c){function d(b){c&&c(null,b),j.set(a,b)}function e(){c&&c(!0)}function l(){g--,delete h[a],n.onDeckRequestArgs&&(n._get.apply(n,n.onDeckRequestArgs),n.onDeckRequestArgs=null)}if(a===k){var m,n=this;(m=h[a])?m.then(f(d),e):i>g?(g++,h[a]=this._send(a,b).then(f(d),e)["finally"](l)):this.onDeckRequestArgs=[].slice.call(arguments,0)}},get:function(b,c,e){var f;return a.isFunction(c)&&(e=c,c={}),k=b,(f=j.get(b))?d(function(){e&&e(null,f)},0):this._get(b,c,e),!!f}}),c}();return g})}(),function(){"use strict";var b=a.module("bloodhound.search-index",[]);b.factory("SearchIndex",function(b){var c=b("filter"),d=function(){function b(a){if(a=a||{},!a.datumTokenizer||!a.queryTokenizer)throw new Error("datumTokenizer and queryTokenizer are both required");this.datumTokenizer=a.datumTokenizer,this.queryTokenizer=a.queryTokenizer,this.reset()}function d(a){return a=c(a,function(a){return!!a}),a=a.map(function(a){return a.toLowerCase()})}function e(){return{ids:[],children:{}}}function f(a){for(var b={},c=[],d=0;d<a.length;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c}function g(a,b){function c(a,b){return a-b}var d=0,e=0,f=[];for(a=a.sort(c),b=b.sort(c);d<a.length&&e<b.length;)a[d]<b[e]?d++:a[d]>b[e]?e++:(f.push(a[d]),d++,e++);return f}return a.extend(b.prototype,{bootstrap:function(a){this.datums=a.datums,this.trie=a.trie},add:function(b){var c=this;b=a.isArray(b)?b:[b],a.forEach(b,function(b){var f,g;f=c.datums.push(b)-1,g=d(c.datumTokenizer(b)),a.forEach(g,function(a){var b,d,g;for(b=c.trie,d=a.split("");g=d.shift();)b=b.children[g]||(b.children[g]=e()),b.ids.push(f)})})},get:function(b){var c,e,h=this;return c=d(this.queryTokenizer(b)),a.forEach(c,function(a){var b,c,d,f;if(e&&0===e.length)return!1;for(b=h.trie,c=a.split("");b&&(d=c.shift());)b=b.children[d];return b&&0===c.length?(f=b.ids.slice(0),void(e=e?g(e,f):f)):(e=[],!1)}),e?f(e).map(function(a){return h.datums[a]}):[]},reset:function(){this.datums=[],this.trie=e()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),b}();return d})}(),function(){"use strict";var c=a.module("bloodhound.options-parser",["bloodhound.util"]);c.factory("oParser",function(c){var d=function(){function d(a){return a.local||null}function e(c){var d,e;if(e={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(d=c.prefetch||null)&&(d=a.isString(d)?{url:d}:d,d=a.extend(e,d),d.thumbprint=b+d.thumbprint,d.ajax.type=d.ajax.type||"GET",d.ajax.dataType=d.ajax.dataType||"json",!d.url))throw new Error("prefetch requires url to be set");return d}function f(b){function d(a){return function(b){return c.debounce(b,a)}}function e(a){return function(b){return c.throttle(b,a)}}var f,g;if(g={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(f=b.remote||null)&&(f=a.isString(f)?{url:f}:f,f=a.extend(g,f),f.rateLimiter=/^throttle$/i.test(f.rateLimitBy)?e(f.rateLimitWait):d(f.rateLimitWait),f.ajax.type=f.ajax.type||"GET",f.ajax.dataType=f.ajax.dataType||"json",delete f.rateLimitBy,delete f.rateLimitWait,!f.url))throw new Error("remote requires url to be set");return f}return{local:d,prefetch:e,remote:f}}();return d})}(),function(){"use strict";var b=a.module("bloodhound",["bloodhound.tokenizers","bloodhound.options-parser","bloodhound.search-index","bloodhound.persistent-storage","bloodhound.transport"]);b.factory("Bloodhound",function(b,c,d,e,f,g,h,i){var j=function(){function b(a){if(!a||!a.local&&!a.prefetch&&!a.remote)throw new Error("one of local, prefetch, or remote is required");this.limit=a.limit||5,this.sorter=j(a.sorter),this.dupDetector=a.dupDetector||k,this.local=f.local(a),this.prefetch=f.prefetch(a),this.remote=f.remote(a),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new g({datumTokenizer:a.datumTokenizer,queryTokenizer:a.queryTokenizer}),this.storage=this.cacheKey?new h(this.cacheKey):null}function j(b){function c(a){return a.sort(b)}function d(a){return a}return a.isFunction(b)?c:d}function k(){return!1}var l;return l={data:"data",protocol:"protocol",thumbprint:"thumbprint"},b.tokenizers=e,a.extend(b.prototype,{_loadPrefetch:function(a){function b(b){g.clear(),g.add(a.filter?a.filter(b):b),g._saveToStorage(g.index.serialize(),a.thumbprint,a.ttl)}var e,f,g=this;if(e=this._readFromStorage(a.thumbprint)){this.index.bootstrap(e);var h=c.defer();h.resolve(),f=h.promise}else f=d.get(a.url,a.ajax).success(b);return f},_getFromRemote:function(b,c){function d(b,d){return b?void c([]):(a.isFunction(g.remote.transform)&&(d=g.remote.transform(d)),void c(g.remote.filter?g.remote.filter(d):d))}var e,f,g=this;return b=b||"",f=encodeURIComponent(b),e=this.remote.replace?this.remote.replace(this.remote.url,b):this.remote.url.replace(this.remote.wildcard,f),this.transport.get(e,this.remote.ajax,d)},_saveToStorage:function(a,b,c){this.storage&&(this.storage.set(l.data,a,c),this.storage.set(l.protocol,location.protocol,c),this.storage.set(l.thumbprint,b,c))},_readFromStorage:function(a){var b,c={};return this.storage&&(c.data=this.storage.get(l.data),c.protocol=this.storage.get(l.protocol),c.thumbprint=this.storage.get(l.thumbprint)),b=c.thumbprint!==a||c.protocol!==location.protocol,c.data&&!b?c.data:null},_initialize:function(){function b(){e.add(a.isFunction(f)?f():f)}var d,e=this,f=this.local;if(this.prefetch)d=this._loadPrefetch(this.prefetch);else{var g=c.defer();g.resolve(),d=g.promise}return f&&d.then(b),this.transport=this.remote?new i(this.remote):null,this.initPromise=d},initialize:function(a){return!this.initPromise||a?this._initialize():this.initPromise},add:function(a){this.index.add(a)},get:function(b,c){function d(b){var d=f.slice(0);a.forEach(b,function(a){var b;return b=d.some(function(b){return e.dupDetector(a,b)}),!b&&d.push(a),d.length<e.limit}),c&&c(e.sorter(d))}var e=this,f=[],g=!1;f=this.index.get(b),f=this.sorter(f).slice(0,this.limit),f.length<this.limit&&this.transport&&(g=this._getFromRemote(b,d)),g||(f.length>0||!this.transport)&&c&&c(f)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&i.resetCache()}}),b}();return j})}(),function(){"use strict";var b=a.module("bloodhound.util",[]);b.factory("util",function(a){return{debounce:function(b,c,d){var e,f;return function(){var g,h,i=this,j=arguments;return g=function(){e=null,d||(f=b.apply(i,j))},h=d&&!e,a.cancel(e),e=a(g,c),h&&(f=b.apply(i,j)),f}},throttle:function(a,b){var c,d,e,f,g,h;return g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)},function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}}}})}()}(window.angular);var g=a.module("ng-atp",["bloodhound"]);return a.module("ng-atp").factory("ATPStates",["Bloodhound",b]).factory("ATPhelpers",function(){return{isEmpty:c,startWith:d}}).constant("ATPEvents",{COMPLETE:"ngAtp:autocomplete",triggers:{enter:"ENTER",manual:"MANUAL",click:"CLICK",tab:"TAB",rightArrow:"RIGHT_ARROW"}}),a.module("ng-atp").controller("ATPMainCtrl",["$scope","$element","$parse","ATPStates","ATPhelpers","ATPEvents",f]),a.module("ng-atp").directive("ngAtp",["$parse",function(){function a(){return function(){}}return{restrict:"AE",compile:a,scope:!0,controller:"ATPMainCtrl"}}]).directive("ngAtpInput",["$compile","$parse","$document","$timeout","ATPhelpers","ATPEvents",function(b,c,d,e,f,g){function h(a,c){var h=!c.ngModel;return h&&a.attr("ng-model","ATP.query"),function(a,c){if(h)return void b(c)(a);var k=j(c);k.attr("ng-show","ATP.showSuggestions"),c.parent()[0].insertBefore(k[0],c[0]),b(k)(a),c.bind("keydown",function(b){if(k.val(""),40==b.keyCode)a.ATP.suggestions.length>0&&b.preventDefault(),a.$apply(function(){a.ATP.select(a.ATP.selected+1)});else if(38==b.keyCode)a.ATP.suggestions.length>0&&b.preventDefault(),a.$apply(function(){a.ATP.select(a.ATP.selected-1)});else if(13==b.keyCode)b.preventDefault(),a.$apply(function(){a.ATP.tryComplete()&&a.$emit(g.COMPLETE,{value:a.ATP.importValue(),triggeredBy:g.triggers.enter,model:a.ATP.modelExpression})});else if(39==b.keyCode){if(!a.ATP.completeOn.rightArrow)return;if(i(c[0])<c.val().length)return;b.preventDefault();{a.ATP.getSuggested(!0)}a.$apply(function(){a.ATP.showSuggestions=!a.ATP.tryComplete(),a.ATP.showSuggestions||a.$emit(g.COMPLETE,{value:a.ATP.importValue(),triggeredBy:g.triggers.rightArrow,model:a.ATP.modelExpression})})}else if(9==b.keyCode){if(!a.ATP.completeOn.tab)return;a.$apply(a.ATP.selected>-1?function(){a.ATP.showSuggestions=!a.ATP.tryComplete(),a.ATP.showSuggestions||a.$emit(g.COMPLETE,{value:a.ATP.importValue(),triggeredBy:g.triggers.tab,model:a.ATP.modelExpression})}:function(){a.ATP.showSuggestions=!1})}}),c.bind("keyup",function(){var b=a.ATP.getSuggested(!0),d=a.ATP.format(b);a.ATP.showSuggestions&&f.startWith(d,c.val())&&k.val(d)}),c.bind("click",function(a){a.stopPropagation()}),c.bind("blur",function(){e(function(){a.ATP.showSuggested=!1},25)}),d.bind("click",function(){a.$apply(function(){a.ATP.showSuggestions=!1})})}}function i(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b}function j(b){return a.element('<input class="tt-hint" type="text" autocomplete="false" spellcheck="false" disabled>').css({padding:b.css("padding"),fontFamily:b.css("font-family"),fontSize:b.css("font-size"),fontStyle:b.css("font-style"),fontVariant:b.css("font-variant"),fontWeight:b.css("font-weight"),wordSpacing:b.css("word-spacing"),letterSpacing:b.css("letter-spacing"),textIndent:b.css("text-indent"),textRendering:b.css("text-rendering"),textTransform:b.css("text-transform"),color:"gray",width:b.css("width")})}return{restrict:"A",require:"^ngAtp",terminal:!0,compile:h,scope:!1}}]).directive("ngAtpSuggestions",["$parse","$compile",function(b,c){var d=["<li ",'ng-repeat="suggestion in ATP.suggestions track by (ATP._idAttrib ? suggestion[ATP._idAttrib] : $id(suggestion))"','ng-click="onClickSuggestion($index); $event.stopPropagation(); $event.preventDefault()" ','ng-class="{ selected : $index == ATP.selected }" ','ng-mouseover="ATP.select($index)">','<ng-switch on="$templateUrl">','  <span ng-switch-when="false">{{ ATP.format(suggestion) }}</span>','  <ng-switch-default><ng-include src="$templateUrl"></ng-include></ng-switch-default>',"</ng-switch>","</li>"].join("");return{require:"^ngAtp",restrict:"AE",scope:!1,compile:function(e,f){var g=!f.ngShow;return e.attr("ng-show","ATP.showSuggestions"),{pre:function(a,e,f){return g?(e[0].innerHTML=d,void c(e)(a)):void(a.$templateUrl=f.templateUrl?b(f.templateUrl)(a):!1)},post:a.noop}}}}]),Array.prototype.findIndex||(Array.prototype.findIndex=function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return f;return-1}),Array.prototype.find||(Array.prototype.find=function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return b;return void 0}),Array.prototype.some||(Array.prototype.some=function(a){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof a)throw new TypeError;for(var b=Object(this),c=b.length>>>0,d=arguments.length>=2?arguments[1]:void 0,e=0;c>e;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null==this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=new Array(g),e=0;g>e;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d}),g});